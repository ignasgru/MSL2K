<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Click the Ball â€” Play</title>
  <style>
    html,body { height:100%; margin:0; font-family: system-ui, sans-serif; background:#0f172a; color:#e6eef8; display:flex; align-items:center; justify-content:center; }
    .wrap { text-align:center; }
    canvas { background:#071031; border-radius:8px; display:block; margin:16px auto; }
    .info { margin-top:10px; }
    button { background:#0ea5a4; color:#042023; border:0; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:700; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Click the Ball</h1>
    <p>Click the moving ball to score. You have 20 seconds. Try to beat your high score!</p>
    <canvas id="game" width="480" height="320"></canvas>
    <div class="info">
      <span id="score">Score: 0</span> &nbsp;|&nbsp; <span id="time">Time: 20</span>s
      <div style="margin-top:10px;">
        <button id="start">Start Game</button>
        <button id="restart" style="margin-left:8px">Restart</button>
      </div>
      <p id="message" style="margin-top:12px"></p>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const msg = document.getElementById('message');
    const startBtn = document.getElementById('start');
    const restartBtn = document.getElementById('restart');

    const w = canvas.width, h = canvas.height;
    let ball = { x: w/2, y: h/2, r: 18, vx: 3, vy: 2.2 };
    let score = 0;
    let timeLeft = 20;
    let running = false, lastTime = null, timerId = null;
    let high = Number(localStorage.getItem('ctb_high')||0);

    function resetBall() {
      ball.x = Math.random()*(w-80)+40;
      ball.y = Math.random()*(h-80)+40;
      ball.vx = (Math.random() > 0.5 ? 1 : -1) * (2 + Math.random()*3);
      ball.vy = (Math.random() > 0.5 ? 1 : -1) * (1.5 + Math.random()*2.5);
    }

    function draw() {
      ctx.clearRect(0,0,w,h);
      ctx.beginPath();
      ctx.fillStyle = 'rgba(0,0,0,0.25)';
      ctx.ellipse(ball.x+6, ball.y+8, ball.r*0.9, ball.r*0.5, 0, 0, Math.PI*2);
      ctx.fill();
      let g = ctx.createLinearGradient(ball.x-ball.r, ball.y-ball.r, ball.x+ball.r, ball.y+ball.r);
      g.addColorStop(0,'#f97316'); g.addColorStop(1,'#ffb86b');
      ctx.beginPath();
      ctx.fillStyle = g;
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
      ctx.fill();
      ctx.beginPath();
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.arc(ball.x-ball.r*0.3, ball.y-ball.r*0.3, ball.r*0.25, 0, Math.PI*2);
      ctx.fill();
    }

    function update(dt) {
      ball.x += ball.vx * dt;
      ball.y += ball.vy * dt;
      if (ball.x - ball.r < 0) { ball.x = ball.r; ball.vx *= -1; }
      if (ball.x + ball.r > w) { ball.x = w - ball.r; ball.vx *= -1; }
      if (ball.y - ball.r < 0) { ball.y = ball.r; ball.vy *= -1; }
      if (ball.y + ball.r > h) { ball.y = h - ball.r; ball.vy *= -1; }
    }

    function loop(ts) {
      if (!lastTime) lastTime = ts;
      const dt = (ts - lastTime) / 16.666;
      lastTime = ts;
      update(dt);
      draw();
      if (running) requestAnimationFrame(loop);
    }

    canvas.addEventListener('click', (e) => {
      if (!running) return;
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const dx = mx - ball.x, dy = my - ball.y;
      if (dx*dx + dy*dy <= ball.r*ball.r) {
        score += 1;
        scoreEl.textContent = 'Score: ' + score;
        ball.vx *= 1.08;
        ball.vy *= 1.08;
        resetBall();
      }
    });

    function tickTimer() {
      timeLeft -= 1;
      timeEl.textContent = timeLeft;
      if (timeLeft <= 0) endGame();
    }

    function startGame() {
      score = 0; timeLeft = 20;
      scoreEl.textContent = 'Score: ' + score;
      timeEl.textContent = timeLeft;
      msg.textContent = '';
      running = true; lastTime = null; resetBall();
      requestAnimationFrame(loop);
      if (timerId) clearInterval(timerId);
      timerId = setInterval(tickTimer, 1000);
    }

    function endGame() {
      running = false;
      if (timerId) { clearInterval(timerId); timerId = null; }
      if (score > high) {
        high = score;
        localStorage.setItem('ctb_high', high);
        msg.textContent = 'NEW HIGH! Score: ' + score;
      } else {
        msg.textContent = 'Time! Score: ' + score + '. High: ' + high;
      }
    }

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', () => {
      running = false;
      if (timerId) { clearInterval(timerId); timerId = null; }
      score = 0; timeLeft = 20;
      scoreEl.textContent = 'Score: 0';
      timeEl.textContent = 20;
      msg.textContent = '';
      lastTime = null;
      resetBall();
      draw();
    });

    resetBall();
    draw();
  </script>
</body>
</html>
